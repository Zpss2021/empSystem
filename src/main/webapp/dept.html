<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>后台主页</title>
    <link rel="stylesheet" href="./assets/layui/css/layui.css">
    <script src="./assets/layui/layui.all.js"></script>
</head>
<style>

</style>
<body>

<form style="display: none;" class="layui-form" lay-filter="departmentForm" id="departmentForm">
    <input name="id" style="display: none;">
    <div class="layui-form-item">
        <label class="layui-form-label">部门名称</label>
        <div class="layui-input-inline">
            <input type="text" name="name" id="dpname2" placeholder="请输入部门名称" autocomplete="off"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">部门状态</label>
        <div class="layui-input-inline">
            <select name="status" lay-verify="required">
                <option value="">--请选择--</option>
                <option value="1">禁用</option>
                <option value="0">启用</option>
            </select>
            <div class="layui-unselect layui-form-select">
                <div class="layui-select-title"><input type="text" placeholder="--请选择--" value="" readonly=""
                                                       class="layui-input layui-unselect"><i class="layui-edge"></i>
                </div>
                <dl class="layui-anim layui-anim-upbit">
                    <dd lay-value="" class="layui-select-tips">--请选择--</dd>
                    <dd lay-value="1" class="">禁用</dd>
                    <dd lay-value="0" class="">启用</dd>
                </dl>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-inline" style="width:100%;">
            <button class="layui-btn" lay-submit="" lay-filter="formDemo" style="margin-left: 100px">提交</button>
            <button type="reset" class="layui-btn">重置</button>
        </div>
    </div>
</form>
<table id="demo" lay-filter="test" style="margin-top: -10px;"></table>
<div class="layui-form layui-border-box layui-table-view" lay-filter="LAY-table-1" lay-id="test" style=" ">
    <div class="layui-table-tool">
        <div class="layui-table-tool-temp">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
                <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新</button>
            </div>
        </div>
        <div class="layui-table-tool-self">
            <div class="layui-inline" title="筛选列" lay-event="LAYTABLE_COLS"><i
                    class="layui-icon layui-icon-cols"></i></div>
            <div class="layui-inline" title="导出" lay-event="LAYTABLE_EXPORT"><i
                    class="layui-icon layui-icon-export"></i></div>
            <div class="layui-inline" title="打印" lay-event="LAYTABLE_PRINT"><i
                    class="layui-icon layui-icon-print"></i></div>
        </div>
    </div>
    <div class="layui-table-box">
        <div class="layui-table-header">
            <table class="layui-table" lay-even="" cellspacing="0" cellpadding="0" border="0">
                <thead>
                <tr>
                    <th data-field="dpid" data-key="1-0-0" class=" layui-unselect">
                        <div class="layui-table-cell laytable-cell-1-0-0" align="center"><span>部门编号</span><span
                                class="layui-table-sort layui-inline"><i class="layui-edge layui-table-sort-asc"
                                                                         title="升序"></i><i
                                class="layui-edge layui-table-sort-desc" title="降序"></i></span></div>
                    </th>
                    <th data-field="dpname" data-key="1-0-1" class="">
                        <div class="layui-table-cell laytable-cell-1-0-1" align="center"><span>部门名称</span></div>
                    </th>
                    <th data-field="dpdescribe" data-key="1-0-2" class="">
                        <div class="layui-table-cell laytable-cell-1-0-2" align="center"><span>职务</span></div>
                    </th>
                    <th data-field="count" data-key="1-0-3" class="">
                        <div class="layui-table-cell laytable-cell-1-0-3" align="center"><span>人数</span></div>
                    </th>
                    <th data-field="dpstatus" data-key="1-0-4" class="">
                        <div class="layui-table-cell laytable-cell-1-0-4" align="center"><span>部门状态</span></div>
                    </th>
                    <th data-field="5" data-key="1-0-5" class=" layui-table-col-special">
                        <div class="layui-table-cell laytable-cell-1-0-5"><span>操作</span></div>
                    </th>
                </tr>
                </thead>
            </table>
        </div>
        <div class="layui-table-body layui-table-main">
            <table class="layui-table" lay-even="" cellspacing="0" cellpadding="0" border="0">
                <tbody>
                <tr data-index="0" class="">
                    <td data-field="dpid" data-key="1-0-0" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-0">1</div>
                    </td>
                    <td data-field="dpname" data-key="1-0-1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-1">管理部</div>
                    </td>
                    <td data-field="dpdescribe" data-key="1-0-2" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-2">店长的事</div>
                    </td>
                    <td data-field="count" data-key="1-0-3" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-3">7</div>
                    </td>
                    <td data-field="dpstatus" data-key="1-0-4" data-content="1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-4">
                            <button class="layui-btn layui-btn-sm" lay-event="add">已启用</button>
                        </div>
                    </td>
                    <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                        <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                             lay-event="updDepartment">编辑</a>
                            <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                            <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除</button>
                        </div>
                    </td>
                </tr>
                <tr data-index="1" class="">
                    <td data-field="dpid" data-key="1-0-0" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-0">2</div>
                    </td>
                    <td data-field="dpname" data-key="1-0-1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-1">人事部</div>
                    </td>
                    <td data-field="dpdescribe" data-key="1-0-2" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-2">管理员工</div>
                    </td>
                    <td data-field="count" data-key="1-0-3" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-3">1</div>
                    </td>
                    <td data-field="dpstatus" data-key="1-0-4" data-content="1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-4">
                            <button class="layui-btn layui-btn-sm" lay-event="add">已启用</button>
                        </div>
                    </td>
                    <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                        <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                             lay-event="updDepartment">编辑</a>
                            <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                            <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除</button>
                        </div>
                    </td>
                </tr>
                <tr data-index="2" class="">
                    <td data-field="dpid" data-key="1-0-0" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-0">4</div>
                    </td>
                    <td data-field="dpname" data-key="1-0-1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-1">盘点部</div>
                    </td>
                    <td data-field="dpdescribe" data-key="1-0-2" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-2">数钱和手机的的</div>
                    </td>
                    <td data-field="count" data-key="1-0-3" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-3">2</div>
                    </td>
                    <td data-field="dpstatus" data-key="1-0-4" data-content="1" class="" align="center">
                        <div class="layui-table-cell laytable-cell-1-0-4">
                            <button class="layui-btn layui-btn-sm" lay-event="add">已启用</button>
                        </div>
                    </td>
                    <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                        <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                             lay-event="updDepartment">编辑</a>
                            <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                            <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="layui-table-fixed layui-table-fixed-r layui-hide" style="right: -1px;">
            <div class="layui-table-header">
                <table class="layui-table" lay-even="" cellspacing="0" cellpadding="0" border="0">
                    <thead>
                    <tr>
                        <th data-field="5" data-key="1-0-5" class=" layui-table-col-special">
                            <div class="layui-table-cell laytable-cell-1-0-5"><span>操作</span></div>
                        </th>
                    </tr>
                    </thead>
                </table>
                <div class="layui-table-mend"></div>
            </div>
            <div class="layui-table-body" style="height: 117px;">
                <table class="layui-table" lay-even="" cellspacing="0" cellpadding="0" border="0">
                    <tbody>
                    <tr data-index="0" class="">
                        <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                            <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                                 lay-event="updDepartment">编辑</a>
                                <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                                <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr data-index="1" class="">
                        <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                            <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                                 lay-event="updDepartment">编辑</a>
                                <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                                <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr data-index="2" class="">
                        <td data-field="5" data-key="1-0-5" data-off="true" class="layui-table-col-special">
                            <div class="layui-table-cell laytable-cell-1-0-5"><a class="layui-btn layui-btn-xs"
                                                                                 lay-event="updDepartment">编辑</a>
                                <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
                                <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="layui-table-page">
        <div id="layui-table-page1">
            <div class="layui-box layui-laypage layui-laypage-default" id="layui-laypage-1"><a href="javascript:;"
                                                                                               class="layui-laypage-prev layui-disabled"
                                                                                               data-page="0"><i
                    class="layui-icon"></i></a><span class="layui-laypage-curr"><em
                    class="layui-laypage-em"></em><em>1</em></span><a href="javascript:;"
                                                                      class="layui-laypage-next layui-disabled"
                                                                      data-page="2"><i class="layui-icon"></i></a><span
                    class="layui-laypage-skip">到第<input type="text" min="1" value="1" class="layui-input">页<button
                    type="button" class="layui-laypage-btn">确定</button></span><span
                    class="layui-laypage-count">共 3 条</span><span class="layui-laypage-limits"><select lay-ignore=""><option
                    value="5" selected="">5 条/页</option><option value="10">10 条/页</option><option
                    value="15">15 条/页</option><option value="20">20 条/页</option></select></span></div>
        </div>
    </div>
    <style>.laytable-cell-1-0-0 {
    }

    .laytable-cell-1-0-1 {
    }

    .laytable-cell-1-0-2 {
    }

    .laytable-cell-1-0-3 {
    }

    .laytable-cell-1-0-4 {
        width: 100px;
    }

    .laytable-cell-1-0-5 {
        width: 200px;
    }</style>
</div>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
        <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新</button>
    </div>
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="updDepartment">编辑</a>
    {{#  if(d.status == 0){ }}
    <button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="upStatus">禁用</button>
    {{#  } else { }}
    <button class="layui-btn layui-btn-normal layui-btn-xs" lay-event="upStatus">启用</button>
    {{#  } }}

    <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delStatus">删除</button>
</script>

<script type="text/html" id="titleTpl">
    {{#  if(d.status == 1){ }}
    <button class="layui-btn  layui-btn-sm" lay-event="add">已启用</button>
    {{#  } else if(d.status == 0){ }}
    <button class="layui-btn layui-btn-danger layui-btn-sm" lay-event="add">已禁用</button>
    {{#  } }}
</script>
<script>
    layui.use(['table', 'form', 'jquery', 'layer', 'laydate', 'element'], function () {
        var table = layui.table;
        var form = layui.form;
        var $ = layui.jquery;
        var layer = layui.layer;
        var laydate = layui.laydate;
        var element = layui.element;
        var tableContent = new Array();
        //加载表格的实例
        table.render({
            id: "test",
            //elem element 元素---》表格的容器
            elem: '#demo'//table标签的id属性值
            , cellMinWidth: 80
            , url: './dept/gets' //数据接口
            , toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
            , cols: [[ //表头
                {field: 'id', title: '部门编号', sort: true, align: 'center'}
                , {field: 'name', title: '部门名称', align: 'center'}
                , {field: 'createBy', title: '创建人', align: 'center'}
                , {
                    field: 'createTime', title: '创建时间', align: 'center', templet: function (d) {
                        return layui.util.toDateString(d.createTime, "yyyy-MM-dd HH:mm")
                    }
                }
                , {
                    field: 'status', title: '部门状态', align: 'center', templet: function (d) {
                        return d.status == 0 ? "启用" : "禁用";
                    }
                }
                , {fixed: 'right', title: '操作', width: 200, toolbar: '#barDemo'}
            ]],
            even: true,
            page: true,//开启分页
            limit: 5,//默认每页显示的条数
            limits: [5, 10, 15, 20],//自定义分页条数的选择
            //结构转换
            parseData: function (res) {
                return {
                    "code": res.id, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.data.total, //解析数据长度
                    "data": res.data.list //解析数据列表
                };
            }
        });
        $("#dpname2").blur(function () {
            console.log(this.value)
            for (let i = 0; i < tableContent.length; i++) {
                if (this.value == tableContent[i].dpname) {
                    layer.msg("该部门已存在！", {icon: 5})
                }
            }
        })
        //表单的提交事件
        //监听事件
        form.on('submit(formDemo)', function (data) {
            //向后台发送请求
            $.ajax({
                url: './dept/addOrUpdPosition',
                type: "POST",
                data: data.field,
                //因为layui 在表单提交时 有时候会自动拦截我们的异步请求
                //所以此处改位同步请求
                async: false,
                dataType: "json",
                success: function (result) {
                    if (result.id == 0) {
                        //重载表格
                        layer.closeAll();
                        layer.msg(result.msg, {icon: 1});
                        table.reload("test");
                    } else {
                        layer.msg(result.msg, {icon: 5});
                    }
                }
            })
            return false;
        });
        //头工具栏事件
        //toolbar()括号中的参数就是  table容器中 lay-filter属性的值
        table.on('toolbar(test)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                /**
                 * case后边的具体字符串跟 toolbarDemo中的 lay-event属性值一样
                 */
                case 'add':
                    //先执行清空表单的方法，再打开弹出框
                    $("#departmentForm")[0].reset();
                    layer.open({
                        type: 1,
                        anim: 3,
                        title: '新增部门信息',
                        content: $("#departmentForm"), //这里content是一个普通的String
                        offset: '50px',
                        area: ['400px', '250px']
                    });
                    break;
                case 'refresh':
                    //刷新
                    table.reload('test', {
                        page: {
                            curr: 1 //重新从第 1 页开始
                        }
                    }); //只重载数据
                    break;
            }
            ;
        });
        //监听行工具事件
        ////tool()括号中的参数就是  table容器中 lay-filter属性的值
        table.on('tool(test)', function (obj) {
            //取出当前点击的行的数据
            var data = obj.data;
            if (obj.event === 'upStatus') {
                layer.confirm("真的要启用/禁用吗？", function (index) {
                    $.ajax({
                        type: 'get'
                        , url: './dept/updStatus'
                        , data: {"id": data.id, "status": data.status}
                        , dataType: 'json'
                        , success: function (result) {
                            if (result.id == 0) {
                                layer.msg(result.msg, {icon: 5});
                                table.reload("test");
                            }
                            layer.msg(result.msg, {icon: 1});
                        }
                    })
                    layer.close(index);
                })
            } else if (obj.event === 'delStatus') {
                layer.confirm("确定要删除该部门吗？", function (index) {
                    $.ajax({
                        type: 'get'
                        , url: './dept/delDept'
                        , data: {"id": data.id}
                        , dataType: 'json'
                        , success: function (result) {
                            if (result.id == 0) {
                                layer.msg(result.msg, {icon: 5});
                                table.reload("test");
                            }
                            layer.msg(result.msg, {icon: 1});
                        }
                    })
                    layer.close(index);
                })
            } else if (obj.event === 'updDepartment') {
                //先执行清空表单的方法，再打开弹出框
                $("#departmentForm")[0].reset();
                layer.open({
                    type: 1,
                    title: '修改部门信息',
                    content: $("#departmentForm"), //这里content是一个普通的String
                    area: ['400px', '300px'],
                    offset: 't',
                    success: function () {
                        form.val("departmentForm", data);//点击编辑时，填充数据
                        $("#rid").val(obj.data.id)
                    }
                });
            }
        });

    });
</script>


</body>
</html>
